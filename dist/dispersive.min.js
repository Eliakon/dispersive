(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Dispersive=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";exports.byteLength=byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function placeHoldersCount(b64){var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}return b64[len-2]==="="?2:b64[len-1]==="="?1:0}function byteLength(b64){return b64.length*3/4-placeHoldersCount(b64)}function toByteArray(b64){var i,j,l,tmp,placeHolders,arr;var len=b64.length;placeHolders=placeHoldersCount(b64);arr=new Arr(len*3/4-placeHolders);l=placeHolders>0?len-4:len;var L=0;for(i=0,j=0;i<l;i+=4,j+=3){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[L++]=tmp>>16&255;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}if(placeHolders===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[L++]=tmp&255}else if(placeHolders===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var output="";var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];output+=lookup[tmp>>2];output+=lookup[tmp<<4&63];output+="=="}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];output+=lookup[tmp>>10];output+=lookup[tmp>>4&63];output+=lookup[tmp<<2&63];output+="="}parts.push(output);return parts.join("")}},{}],2:[function(require,module,exports){(function(global){"use strict";var base64=require("base64-js");var ieee754=require("ieee754");var isArray=require("isarray");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;Buffer.TYPED_ARRAY_SUPPORT=global.TYPED_ARRAY_SUPPORT!==undefined?global.TYPED_ARRAY_SUPPORT:typedArraySupport();exports.kMaxLength=kMaxLength();function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42&&typeof arr.subarray==="function"&&arr.subarray(1,1).byteLength===0}catch(e){return false}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length){throw new RangeError("Invalid typed array length")}if(Buffer.TYPED_ARRAY_SUPPORT){that=new Uint8Array(length);that.__proto__=Buffer.prototype}else{if(that===null){that=new Buffer(length)}that.length=length}return that}function Buffer(arg,encodingOrOffset,length){if(!Buffer.TYPED_ARRAY_SUPPORT&&!(this instanceof Buffer)){return new Buffer(arg,encodingOrOffset,length)}if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}Buffer.poolSize=8192;Buffer._augment=function(arr){arr.__proto__=Buffer.prototype;return arr};function from(that,value,encodingOrOffset,length){if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof ArrayBuffer!=="undefined"&&value instanceof ArrayBuffer){return fromArrayBuffer(that,value,encodingOrOffset,length)}if(typeof value==="string"){return fromString(that,value,encodingOrOffset)}return fromObject(that,value)}Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)};if(Buffer.TYPED_ARRAY_SUPPORT){Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;if(typeof Symbol!=="undefined"&&Symbol.species&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true})}}function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be a number')}else if(size<0){throw new RangeError('"size" argument must not be negative')}}function alloc(that,size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(that,size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill)}return createBuffer(that,size)}Buffer.alloc=function(size,fill,encoding){return alloc(null,size,fill,encoding)};function allocUnsafe(that,size){assertSize(size);that=createBuffer(that,size<0?0:checked(size)|0);if(!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<size;++i){that[i]=0}}return that}Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)};function fromString(that,string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError('"encoding" must be a valid string encoding')}var length=byteLength(string,encoding)|0;that=createBuffer(that,length);var actual=that.write(string,encoding);if(actual!==length){that=that.slice(0,actual)}return that}function fromArrayLike(that,array){var length=array.length<0?0:checked(array.length)|0;that=createBuffer(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromArrayBuffer(that,array,byteOffset,length){array.byteLength;if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError("'offset' is out of bounds")}if(array.byteLength<byteOffset+(length||0)){throw new RangeError("'length' is out of bounds")}if(byteOffset===undefined&&length===undefined){array=new Uint8Array(array)}else if(length===undefined){array=new Uint8Array(array,byteOffset)}else{array=new Uint8Array(array,byteOffset,length)}if(Buffer.TYPED_ARRAY_SUPPORT){that=array;that.__proto__=Buffer.prototype}else{that=fromArrayLike(that,array)}return that}function fromObject(that,obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;that=createBuffer(that,len);if(that.length===0){return that}obj.copy(that,0,0,len);return that}if(obj){if(typeof ArrayBuffer!=="undefined"&&obj.buffer instanceof ArrayBuffer||"length"in obj){if(typeof obj.length!=="number"||isnan(obj.length)){return createBuffer(that,0)}return fromArrayLike(that,obj)}if(obj.type==="Buffer"&&isArray(obj.data)){return fromArrayLike(that,obj.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=kMaxLength()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength().toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return!!(b!=null&&b._isBuffer)};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(typeof ArrayBuffer!=="undefined"&&typeof ArrayBuffer.isView==="function"&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer)){return string.byteLength}if(typeof string!=="string"){string=""+string}var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case undefined:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length|0;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target)){throw new TypeError("Argument must be a Buffer")}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(isNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(Buffer.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new TypeError("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset|0;if(isFinite(length)){length=length|0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,undefined);for(var i=0;i<sliceLen;++i){newBuf[i]=this[i+start]}}return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=value&255;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT){
for(i=0;i<len;++i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(val.length===1){var code=val.charCodeAt(0);if(code<256){val=code}}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString());var len=bytes.length;for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isnan(val){return val!==val}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"base64-js":1,ieee754:3,isarray:4}],3:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],4:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return toString.call(arr)=="[object Array]"}},{}],5:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],6:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],7:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],8:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":7,_process:5,inherits:6}],9:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var hat=require("hat");var Dispatcher=require("./dispatcher");var Tree=require("./tree");var SUBS=["before","error"];var Action=function(){_createClass(Action,null,[{key:"create",value:function create(handler){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};opts=Object.assign({dispatcher:Dispatcher.main,type:Action},opts);var ActionType=opts.type;var action=new ActionType(handler,opts.dispatcher);return action.wrapper}}]);function Action(){var handler=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var _this=this;var dispatcher=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Dispatcher.main;var isSubAction=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;_classCallCheck(this,Action);this.dispatcher=dispatcher;this.actionType=hat();this.handler=handler;this.wrapper=this.buildWrapper();if(!isSubAction)SUBS.forEach(function(name){return _this.attachSubAction(name)})}_createClass(Action,[{key:"attachSubAction",value:function attachSubAction(name){var action=new Action(null,this.dispatcher,true);this[name]=action;this.wrapper[name]=action.wrapper}},{key:"buildWrapper",value:function buildWrapper(){var _this2=this;var wrapper=function wrapper(){return _this2.callHandler.apply(_this2,arguments)};wrapper.action=this;wrapper.subscribe=function(listener){return _this2.dispatcher.subscribe(_this2,listener)};wrapper.unsubscribe=function(listener){return _this2.dispatcher.unsubscribe(_this2,listener)};return wrapper}},{key:"trigger",value:function trigger(data){this.dispatcher.trigger(this,data)}},{key:"callHandler",value:function callHandler(){var _before,_handler,_this3=this;for(var _len=arguments.length,argv=Array(_len),_key=0;_key<_len;_key++){argv[_key]=arguments[_key]}if(!!this.before)(_before=this.before).trigger.apply(_before,argv);var res=this.handler===null?null:(_handler=this.handler).call.apply(_handler,[this].concat(argv));var promise=res instanceof Promise?res:new Promise(function(resolve){return resolve(res)});promise.then(function(data){return _this3.trigger(data)})["catch"](function(error){return _this3.error.trigger(error)});return promise}}]);return Action}();var ActionTree=function(_Tree){_inherits(ActionTree,_Tree);function ActionTree(){_classCallCheck(this,ActionTree);return _possibleConstructorReturn(this,(ActionTree.__proto__||Object.getPrototypeOf(ActionTree)).apply(this,arguments))}_createClass(ActionTree,[{key:"_register",value:function _register(name,handler){if(!!handler&&!!handler.action&&handler.action instanceof Action){this[name]=handler}else{this[name]=Action.create(handler)}this._leafs.add(name);return this[name]}}]);return ActionTree}(Tree);module.exports={Action:Action,ActionTree:ActionTree}},{"./dispatcher":10,"./tree":19,hat:31}],10:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var _require=require("./object");var omit=_require.omit;var FluxDispatcher=require("flux").Dispatcher;var Dispatcher=function(_FluxDispatcher){_inherits(Dispatcher,_FluxDispatcher);function Dispatcher(){_classCallCheck(this,Dispatcher);var _this=_possibleConstructorReturn(this,(Dispatcher.__proto__||Object.getPrototypeOf(Dispatcher)).call(this));_this.mapping={};_this.register(function(data){return _this.react(data)});return _this}_createClass(Dispatcher,[{key:"subscribe",value:function subscribe(action,listener){if(!(action.actionType in this.mapping))this.mapping[action.actionType]=new Set;this.mapping[action.actionType].add(listener)}},{key:"unsubscribe",value:function unsubscribe(action,listener){if(!(action.actionType in this.mapping))return;this.mapping[action.actionType]["delete"](listener)}},{key:"react",value:function react(data){if(!(data.actionType in this.mapping))return;this.mapping[data.actionType].forEach(function(handler){return setTimeout(function(){return handler(omit(data,"actionType"))},0)})}},{key:"trigger",value:function trigger(action,data){this.dispatch(Object.assign({actionType:action.actionType},data))}}]);return Dispatcher}(FluxDispatcher);Dispatcher.main=new Dispatcher;module.exports=Dispatcher},{"./object":15,flux:28}],11:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var FBEmitter=require("fbemitter").EventEmitter;var funnels=[];var funnel=null;var Emittable=function(){function Emittable(){_classCallCheck(this,Emittable)}_createClass(Emittable,[{key:"emitChange",value:function emitChange(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.emit("change",data)}},{key:"changed",value:function changed(listener){var ctx=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return this.on("change",listener,ctx)}},{key:"on",value:function on(name,listener){var ctx=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return this.emitter.addListener(name,function(data){return listener.call(ctx,data)})}},{key:"emit",value:function emit(name){var data=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!!funnel)return funnel.add({emitter:this.emitter,name:name,data:data});this.emitter.emit(name,data)}}]);return Emittable}();var EventEmitter=function(_Emittable){_inherits(EventEmitter,_Emittable);function EventEmitter(){_classCallCheck(this,EventEmitter);var _this=_possibleConstructorReturn(this,(EventEmitter.__proto__||Object.getPrototypeOf(EventEmitter)).call(this));_this.emitter=new FBEmitter;return _this}_createClass(EventEmitter,null,[{key:"createEmitter",value:function createEmitter(){return new FBEmitter}}]);return EventEmitter}(Emittable);var Funnel=function(){function Funnel(){_classCallCheck(this,Funnel);this.stack=[]}_createClass(Funnel,[{key:"same",value:function same(emitted,stacked){return emitted.emitter===stacked.emitter&&emitted.name===stacked.name&&stacked.data.sources.has(emitted.data.source)}},{key:"addSource",value:function addSource(emitted,stacked){if(emitted.emitter!==stacked.emitter)return false;if(emitted.name!==stacked.name)return false;if("source"in emitted.data)stacked.data.sources.add(emitted.data.source);return true}},{key:"merge",value:function merge(emitted,stacked){return this.same(emitted,stacked)||this.addSource(emitted,stacked)}},{key:"mergeToStack",value:function mergeToStack(emitted){var merged=false;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.stack[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var stacked=_step.value;if(this.merge(emitted,stacked)){merged=true;break}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}return merged}},{key:"add",value:function add(event){if(this.mergeToStack(event))return;event.data.sources=new Set;if("source"in event.data){event.data.sources.add(event.data.source);delete event.data.source}this.stack.push(event)}},{key:"emit",value:function emit(){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.stack[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var event=_step2.value;event.data.sources=Array.from(event.data.sources);event.emitter.emit(event.name,event.data)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}this.stack=[]}}],[{key:"using",value:function using(handler){funnel=new Funnel;funnels.push(funnel);handler(funnel);funnel.emit();funnels.pop();funnel=funnels.length===0?null:funnels[funnels.length-1]}}]);return Funnel}();EventEmitter.Emittable=Emittable;EventEmitter.Funnel=Funnel;module.exports=EventEmitter},{fbemitter:21}],12:[function(require,module,exports){"use strict";var Dispersive=module.exports={};var _require=require("./action");var Action=_require.Action;var ActionTree=_require.ActionTree;Dispersive.Dispatcher=require("./dispatcher");Dispersive.EventEmitter=require("./emitter");Dispersive.ObjectManager=require("./manager");Dispersive.Model=require("./model");Dispersive.QuerySet=require("./queryset");Dispersive.Schema=require("./schema");Dispersive.Store=require("./store");Dispersive.IndexedField=Dispersive.Schema.IndexedField;Dispersive.createAction=Action.create;Dispersive.ActionTree=ActionTree;Dispersive.Action=Action;Dispersive.usingEventFunnel=Dispersive.EventEmitter.Funnel.using;Dispersive.store=new Dispersive.Store;Dispersive.actions=new Dispersive.ActionTree;Dispersive.dispatcher=Dispersive.Dispatcher.main},{"./action":9,"./dispatcher":10,"./emitter":11,"./manager":13,"./model":14,"./queryset":16,"./schema":17,"./store":18}],13:[function(require,module,exports){"use strict";var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{
constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var QuerySet=require("./queryset");var EventEmitter=require("./emitter");var hat=require("hat");var Index=function(){function Index(name){_classCallCheck(this,Index);this.name=name;this.refs={}}_createClass(Index,[{key:"hasRef",value:function hasRef(ref){return ref in this.refs}},{key:"add",value:function add(values){if(this.name in values&&"id"in values){this.link(values[this.name],values);this.refs[values.id]=values[this.name]}}},{key:"delete",value:function _delete(values){if(!(values.id in this.refs))return;var val=this.refs[values.id];this.unlink(val,values);delete this.refs[values.id]}}]);return Index}();var SetIndex=function(_Index){_inherits(SetIndex,_Index);function SetIndex(name){_classCallCheck(this,SetIndex);var _this=_possibleConstructorReturn(this,(SetIndex.__proto__||Object.getPrototypeOf(SetIndex)).call(this,name));_this.values={};_this.sets={};return _this}_createClass(SetIndex,[{key:"link",value:function link(val,values){if(!(val in this.sets))this.sets[val]=new Set;this.values[values.id]=values;this.sets[val].add(values.id)}},{key:"unlink",value:function unlink(val,values){this.sets[val]["delete"](values.id)}},{key:"countOf",value:function countOf(val){return val in this.sets?Array.from(this.sets[val]).length:0}},{key:"allOf",value:regeneratorRuntime.mark(function allOf(val){var _iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,id;return regeneratorRuntime.wrap(function allOf$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(val in this.sets)){_context.next=27;break}_iteratorNormalCompletion=true;_didIteratorError=false;_iteratorError=undefined;_context.prev=4;_iterator=this.sets[val][Symbol.iterator]();case 6:if(_iteratorNormalCompletion=(_step=_iterator.next()).done){_context.next=13;break}id=_step.value;_context.next=10;return this.values[id];case 10:_iteratorNormalCompletion=true;_context.next=6;break;case 13:_context.next=19;break;case 15:_context.prev=15;_context.t0=_context["catch"](4);_didIteratorError=true;_iteratorError=_context.t0;case 19:_context.prev=19;_context.prev=20;if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}case 22:_context.prev=22;if(!_didIteratorError){_context.next=25;break}throw _iteratorError;case 25:return _context.finish(22);case 26:return _context.finish(19);case 27:case"end":return _context.stop()}}},allOf,this,[[4,15,19,27],[20,,22,26]])})}]);return SetIndex}(Index);var UniqueIndex=function(_Index2){_inherits(UniqueIndex,_Index2);function UniqueIndex(name){_classCallCheck(this,UniqueIndex);var _this2=_possibleConstructorReturn(this,(UniqueIndex.__proto__||Object.getPrototypeOf(UniqueIndex)).call(this,name));_this2.kvs={};return _this2}_createClass(UniqueIndex,[{key:"link",value:function link(val,values){if(val in this.kvs)throw new UniqueIndex.AlreadyExists(this.name,val);this.kvs[val]=values}},{key:"unlink",value:function unlink(val){delete this.kvs[val]}},{key:"get",value:function get(val){return this.kvs[val]}},{key:"countOf",value:function countOf(val){return val in this.kvs?1:0}},{key:"allOf",value:regeneratorRuntime.mark(function allOf(val){return regeneratorRuntime.wrap(function allOf$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(val in this.kvs)){_context2.next=3;break}_context2.next=3;return this.kvs[val];case 3:case"end":return _context2.stop()}}},allOf,this)})},{key:"all",value:regeneratorRuntime.mark(function all(){var _iteratorNormalCompletion2,_didIteratorError2,_iteratorError2,_iterator2,_step2,val;return regeneratorRuntime.wrap(function all$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_iteratorNormalCompletion2=true;_didIteratorError2=false;_iteratorError2=undefined;_context3.prev=3;_iterator2=Object.keys(this.kvs)[Symbol.iterator]();case 5:if(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done){_context3.next=12;break}val=_step2.value;_context3.next=9;return this.kvs[val];case 9:_iteratorNormalCompletion2=true;_context3.next=5;break;case 12:_context3.next=18;break;case 14:_context3.prev=14;_context3.t0=_context3["catch"](3);_didIteratorError2=true;_iteratorError2=_context3.t0;case 18:_context3.prev=18;_context3.prev=19;if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]()}case 21:_context3.prev=21;if(!_didIteratorError2){_context3.next=24;break}throw _iteratorError2;case 24:return _context3.finish(21);case 25:return _context3.finish(18);case 26:case"end":return _context3.stop()}}},all,this,[[3,14,18,26],[19,,21,25]])})}]);return UniqueIndex}(Index);UniqueIndex.AlreadyExists=function(){function _class(name,val){_classCallCheck(this,_class);this.name="AlreadyExists";this.message="Model with '"+name+"' = "+val+" already exists"}return _class}();var ObjectManager=function(_QuerySet){_inherits(ObjectManager,_QuerySet);function ObjectManager(model){_classCallCheck(this,ObjectManager);var _this3=_possibleConstructorReturn(this,(ObjectManager.__proto__||Object.getPrototypeOf(ObjectManager)).call(this,{model:model}));if(!model||!model.schema)throw new ObjectManager.NoSchema;_this3.manager=_this3;_this3.generator=_this3.models;_this3.index=_this3.buildIndex();_this3.indexNames=Object.keys(_this3.index).filter(function(name){return name!=="id"});_this3.emitters={};return _this3}_createClass(ObjectManager,[{key:"buildIndex",value:function buildIndex(){var index={};var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.model.schema.fields()[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var _step3$value=_slicedToArray(_step3.value,2);var name=_step3$value[0];var field=_step3$value[1];if(!!field.index){var IndexType=field.unique?UniqueIndex:SetIndex;index[name]=new IndexType(name)}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3["return"]){_iterator3["return"]()}}finally{if(_didIteratorError3){throw _iteratorError3}}}return index}},{key:"models",value:regeneratorRuntime.mark(function models(){var prefilters=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var base,lowerCount,_iteratorNormalCompletion4,_didIteratorError4,_iteratorError4,_iterator4,_step4,prefilter,count,_iteratorNormalCompletion5,_didIteratorError5,_iteratorError5,_iterator5,_step5,values;return regeneratorRuntime.wrap(function models$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:base=this.index.id.all();lowerCount=Infinity;_iteratorNormalCompletion4=true;_didIteratorError4=false;_iteratorError4=undefined;_context4.prev=5;for(_iterator4=prefilters[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){prefilter=_step4.value;count=this.index[prefilter.name].countOf(prefilter.val);if(count<lowerCount){base=this.index[prefilter.name].allOf(prefilter.val);lowerCount=count}}_context4.next=13;break;case 9:_context4.prev=9;_context4.t0=_context4["catch"](5);_didIteratorError4=true;_iteratorError4=_context4.t0;case 13:_context4.prev=13;_context4.prev=14;if(!_iteratorNormalCompletion4&&_iterator4["return"]){_iterator4["return"]()}case 16:_context4.prev=16;if(!_didIteratorError4){_context4.next=19;break}throw _iteratorError4;case 19:return _context4.finish(16);case 20:return _context4.finish(13);case 21:_iteratorNormalCompletion5=true;_didIteratorError5=false;_iteratorError5=undefined;_context4.prev=24;_iterator5=base[Symbol.iterator]();case 26:if(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done){_context4.next=33;break}values=_step5.value;_context4.next=30;return this._modelFromValues(values);case 30:_iteratorNormalCompletion5=true;_context4.next=26;break;case 33:_context4.next=39;break;case 35:_context4.prev=35;_context4.t1=_context4["catch"](24);_didIteratorError5=true;_iteratorError5=_context4.t1;case 39:_context4.prev=39;_context4.prev=40;if(!_iteratorNormalCompletion5&&_iterator5["return"]){_iterator5["return"]()}case 42:_context4.prev=42;if(!_didIteratorError5){_context4.next=45;break}throw _iteratorError5;case 45:return _context4.finish(42);case 46:return _context4.finish(39);case 47:case"end":return _context4.stop()}}},models,this,[[5,9,13,21],[14,,16,20],[24,35,39,47],[40,,42,46]])})},{key:"_modelFromValues",value:function _modelFromValues(values){var ModelType=this.model;var model=new ModelType(values);model.emitter=this.emitters[model.id];return model}},{key:"getOrCreate",value:function getOrCreate(basis){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{emitChange:true};var model=null;try{model=this.get(basis)}catch(err){model=this.create(basis,opts)}return model}},{key:"create",value:function create(data){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{emitChange:true};var ModelType=this.model;var model=new ModelType(data);model.save(opts);return model}},{key:"_syncLinks",value:function _syncLinks(values){var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=this.indexNames[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var indexName=_step6.value;this.index[indexName].add(values)}}catch(err){_didIteratorError6=true;_iteratorError6=err}finally{try{if(!_iteratorNormalCompletion6&&_iterator6["return"]){_iterator6["return"]()}}finally{if(_didIteratorError6){throw _iteratorError6}}}}},{key:"_unsyncLinks",value:function _unsyncLinks(values){var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=this.indexNames[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var indexName=_step7.value;this.index[indexName]["delete"](values)}}catch(err){_didIteratorError7=true;_iteratorError7=err}finally{try{if(!_iteratorNormalCompletion7&&_iterator7["return"]){_iterator7["return"]()}}finally{if(_didIteratorError7){throw _iteratorError7}}}}},{key:"_syncNew",value:function _syncNew(model){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{emitChange:true};var values=null;model.id=hat();model.emitter=EventEmitter.createEmitter();values=model.schemaValues();this.emitters[model.id]=model.emitter;this.index.id.add(values);this._syncLinks(this.index.id.get(model.id));if(opts.emitChange)this.emitChange({source:values})}},{key:"_syncExisting",value:function _syncExisting(model){var schemaValues=null;if(!this.index.id.get(model.id))throw new ObjectManager.ModelNotSyncable;schemaValues=model.schemaValues();Object.assign(this.index.id.get(model.id),schemaValues);this._syncLinks(schemaValues)}},{key:"isValidId",value:function isValidId(id){return this.index.id.hasRef(id)}},{key:"sync",value:function sync(model){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{emitChange:true};if(!!model.id)return this._syncExisting(model);this._syncNew(model,opts)}},{key:"unsync",value:function unsync(model){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{emitChange:true};var values=null;if(!this.index.id.hasRef(model.id))return;values=this.index.id.get(model.id);this._unsyncLinks(values);this.index.id["delete"](values);delete this.emitters[model.id];if(opts.emitChange)this.emitChange({source:values})}}]);return ObjectManager}(QuerySet);ObjectManager.ModelNotSyncable=function extend(){_classCallCheck(this,extend);this.name="ModelNotSyncable";this.message="Could not sync model that was previously deleted"};ObjectManager.NoSchema=function(){function _class2(){_classCallCheck(this,_class2);this.name="NoSchema";this.message="Cannot create a model without a schema"}return _class2}();module.exports=ObjectManager},{"./emitter":11,"./queryset":16,hat:31}],14:[function(require,module,exports){"use strict";var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var clone=require("clone");var ObjectManager=require("./manager");var EventEmitter=require("./emitter");var _require=require("./object");var pick=_require.pick;var Model=function(_EventEmitter$Emittab){_inherits(Model,_EventEmitter$Emittab);function Model(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,Model);var _this=_possibleConstructorReturn(this,(Model.__proto__||Object.getPrototypeOf(Model)).call(this));if(!_this.objects())throw new Model.NoObjectManager;if(!_this.schema())throw new ObjectManager.NoSchema;if("id"in data&&!_this.objects().isValidId(data.id))delete data.id;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=_this.schema().initials()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _step$value=_slicedToArray(_step.value,2);var name=_step$value[0];var initial=_step$value[1];_this[name]=name in data?data[name]:initial}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}return _this}_createClass(Model,[{key:"schemaValues",value:function schemaValues(){return clone(pick.apply(undefined,[this].concat([].concat(_toConsumableArray(this.schema().names())))))}},{key:"values",value:function values(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var values=pick.apply(undefined,[this].concat(_toConsumableArray([].concat(_toConsumableArray(this.schema().names())).filter(function(name){if(!!opts.include&&opts.include.indexOf(name)<0)return false;if(!!opts.exclude&&opts.exclude.indexOf(name)>=0)return false;return true}))));return values}},{key:"on",value:function on(){var _get2;if(!this.emitter)throw new Model.EmitterNotReady;for(var _len=arguments.length,argv=Array(_len),_key=0;_key<_len;_key++){argv[_key]=arguments[_key]}return(_get2=_get(Model.prototype.__proto__||Object.getPrototypeOf(Model.prototype),"on",this)).call.apply(_get2,[this].concat(argv))}},{key:"emit",value:function emit(){var _get3;if(!this.emitter)throw new Model.EmitterNotReady;for(var _len2=arguments.length,argv=Array(_len2),_key2=0;_key2<_len2;_key2++){argv[_key2]=arguments[_key2]}return(_get3=_get(Model.prototype.__proto__||Object.getPrototypeOf(Model.prototype),"emit",this)).call.apply(_get3,[this].concat(argv))}},{key:"save",value:function save(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{emitChange:true};this.constructor.objects.sync(this,opts);if(opts.emitChange)this.emitChange();return this}},{key:"update",value:function update(){var values=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var opts=arguments[1];var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=Object.keys(values)[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var key=_step2.value;if(this.schema().has(key))this[key]=values[key]}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}this.save(opts)}},{key:"delete",value:function _delete(){this.objects().unsync(this)}},{key:"schema",value:function schema(){return this.constructor.schema}},{key:"objects",value:function objects(){return this.constructor.objects}}]);return Model}(EventEmitter.Emittable);Model.EmitterNotReady=function(){function _class(){_classCallCheck(this,_class);this.name="EmitterNotReady";this.message="Emitter cannot be used before saving the model"}return _class}();Model.NoObjectManager=function(){function _class2(){_classCallCheck(this,_class2);this.name="NoObjectManager";this.message="Model has no Object Manager. Use Model.attach() or Model.use()"}return _class2}();module.exports=Model},{"./emitter":11,"./manager":13,"./object":15,clone:20}],15:[function(require,module,exports){"use strict";var object=module.exports={};object.filter=function(src,predicate){var dest={};var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=Object.keys(src)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var key=_step.value;var value=src[key];if(predicate(key,value))dest[key]=value}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}return dest};object.omit=function(src){for(var _len=arguments.length,keys=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){keys[_key-1]=arguments[_key]}return object.filter(src,function(key){return keys.indexOf(key)<0})};object.pick=function(src){for(var _len2=arguments.length,keys=Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++){keys[_key2-1]=arguments[_key2]}return object.filter(src,function(key){return keys.indexOf(key)>=0})}},{}],16:[function(require,module,exports){(function(process){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var EventEmitter=require("./emitter");var util=require("util");var GetterException=function(){function GetterException(){_classCallCheck(this,GetterException)}_createClass(GetterException,[{key:"inlineExpression",value:function inlineExpression(expression){return Object.keys(expression||{}).map(function(name){return name+"="+expression[name]}).join(",")}}]);return GetterException}();var DoesNotExist=function(_GetterException){_inherits(DoesNotExist,_GetterException);function DoesNotExist(expression){_classCallCheck(this,DoesNotExist);var _this=_possibleConstructorReturn(this,(DoesNotExist.__proto__||Object.getPrototypeOf(DoesNotExist)).call(this));_this.name="DoesNotExist";_this.message="Could not find object with ("+_this.inlineExpression(expression)+")";return _this}return DoesNotExist}(GetterException);var MoreThanOneValue=function(_GetterException2){_inherits(MoreThanOneValue,_GetterException2);function MoreThanOneValue(expression){_classCallCheck(this,MoreThanOneValue);var _this2=_possibleConstructorReturn(this,(MoreThanOneValue.__proto__||Object.getPrototypeOf(MoreThanOneValue)).call(this));_this2.name="MoreThanOneValue";_this2.message="Found more than one object with ("+_this2.inlineExpression(expression)+")";return _this2}return MoreThanOneValue}(GetterException);var NotInSchema=function NotInSchema(name){_classCallCheck(this,NotInSchema);this.name="NotInSchema";this.message="Model has no '"+name+"' in schema"};var OutOfRange=function OutOfRange(index){_classCallCheck(this,OutOfRange);this.name="OutOfRange";this.message="index ("+index+") is out of objects range"};var QuerySet=function(_EventEmitter){_inherits(QuerySet,_EventEmitter);function QuerySet(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,QuerySet);var _this3=_possibleConstructorReturn(this,(QuerySet.__proto__||Object.getPrototypeOf(QuerySet)).call(this));_this3.orderedBy=opts.orderedBy||null;_this3.predicate=opts.predicate||null;_this3.parent=opts.parent||null;_this3.prefilters=opts.prefilters||[];_this3.model=opts.model;_this3.generator=opts.generator;_this3.manager=opts.manager;return _this3}_createClass(QuerySet,[{key:"matchExpression",value:function matchExpression(values,expression){var match=true;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=Object.keys(expression)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var name=_step.value;if(!(name in values)||values[name]!==expression[name]){match=false;break}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}return match}},{key:"on",value:function on(name,listener){var _this4=this;var ctx=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(this.manager===this)return _get(QuerySet.prototype.__proto__||Object.getPrototypeOf(QuerySet.prototype),"on",this).call(this,name,listener,ctx);this.manager.on(name,function(data){var targeted="source"in data&&_this4.validate(data.source)||"sources"in data&&_this4.validateAny(data.sources);if(targeted)listener.call(ctx,data)})}},{key:"emit",value:function emit(){var _get2,_manager;for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}if(this.manager===this)return(_get2=_get(QuerySet.prototype.__proto__||Object.getPrototypeOf(QuerySet.prototype),"emit",this)).call.apply(_get2,[this].concat(args));(_manager=this.manager).emit.apply(_manager,args)}},{key:"assertInSchema",value:function assertInSchema(name){if(!this.model.schema.has(name))throw new NotInSchema(name)}},{key:"assertExpressionInSchema",value:function assertExpressionInSchema(expression){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=Object.keys(expression)[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var name=_step2.value;this.assertInSchema(name)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"_extractPrefilters",value:function _extractPrefilters(expression){var prefilters=[];var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=Object.keys(expression)[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var name=_step3.value;var val=expression[name];if(this.model.schema.isIndexed(name)){prefilters.push({name:name,val:val})}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3["return"]){_iterator3["return"]()}}finally{if(_didIteratorError3){throw _iteratorError3}}}return prefilters}},{key:"createQuerySet",value:function createQuerySet(_ref){var _ref$predicate=_ref.predicate;var predicate=_ref$predicate===undefined?null:_ref$predicate;var _ref$prefilters=_ref.prefilters;var prefilters=_ref$prefilters===undefined?[]:_ref$prefilters;var _ref$orderedBy=_ref.orderedBy;var orderedBy=_ref$orderedBy===undefined?null:_ref$orderedBy;return new QuerySet({orderedBy:orderedBy,predicate:predicate,prefilters:prefilters,generator:this.entries.bind(this),manager:this.manager,parent:this,model:this.model})}},{key:"_filterUsingExpression",value:function _filterUsingExpression(expression){var _this5=this;this.assertExpressionInSchema(expression);return this.createQuerySet({predicate:function predicate(values){return _this5.matchExpression(values,expression)},prefilters:this._extractPrefilters(expression)})}},{key:"_filterUsingPredicate",value:function _filterUsingPredicate(predicate){return this.createQuerySet({predicate:predicate})}},{key:"filter",value:function filter(expressionOrPredicate){if(typeof expressionOrPredicate==="function"){return this._filterUsingPredicate(expressionOrPredicate)}return this._filterUsingExpression(expressionOrPredicate)}},{key:"_excludeUsingExpression",value:function _excludeUsingExpression(expression){var _this6=this;this.assertExpressionInSchema(expression);return this.createQuerySet({predicate:function predicate(values){return!_this6.matchExpression(values,expression)}})}},{key:"_excludeUsingPredicate",value:function _excludeUsingPredicate(_predicate){return this.createQuerySet({predicate:function predicate(values){return!_predicate(values)}})}},{key:"exclude",value:function exclude(expressionOrPredicate){if(typeof expressionOrPredicate==="function"){return this._excludeUsingPredicate(expressionOrPredicate)}return this._excludeUsingExpression(expressionOrPredicate)}},{key:"_orderByUsingName",value:function _orderByUsingName(name){this.assertInSchema(name);return this.createQuerySet({orderedBy:function orderedBy(entry){return entry[name]}})}},{key:"_orderByUsingPredicate",value:function _orderByUsingPredicate(predicate){return this.createQuerySet({orderedBy:predicate})}},{key:"orderBy",value:function orderBy(nameOrPredicate){if(typeof nameOrPredicate==="string"){return this._orderByUsingName(nameOrPredicate)}return this._orderByUsingPredicate(nameOrPredicate)}},{key:"validate",value:function validate(values){if(!!this.predicate&&!this.predicate(values))return false;return!!this.parent?this.parent.validate(values):true}},{key:"validateAny",value:function validateAny(valuesArray){var validate=false;var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=valuesArray[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var values=_step4.value;validate=this.validate(values);if(validate)break}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4["return"]){_iterator4["return"]()}}finally{if(_didIteratorError4){throw _iteratorError4}}}return validate}},{key:"sortEntries",value:function sortEntries(entries,predicate){return entries.sort(function(entry1,entry2){var result=0;var value1=predicate(entry1);var value2=predicate(entry2);var sortable=(typeof value1==="undefined"?"undefined":_typeof(value1))===(typeof value2==="undefined"?"undefined":_typeof(value2));if(sortable){switch(typeof value1==="undefined"?"undefined":_typeof(value1)){case"string":result=value1.localeCompare(value2);break;case"number":result=value1-value2;break;default:break}}return result})}},{key:"entries",value:regeneratorRuntime.mark(function entries(){var prefilters=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var mixedPrefilters,entries,_iteratorNormalCompletion5,_didIteratorError5,_iteratorError5,_iterator5,_step5,entry;return regeneratorRuntime.wrap(function entries$(_context){while(1){switch(_context.prev=_context.next){case 0:mixedPrefilters=this.prefilters.concat(prefilters);entries=!!this.orderedBy?this.sortEntries([].concat(_toConsumableArray(this.generator(mixedPrefilters))),this.orderedBy):this.generator(mixedPrefilters);_iteratorNormalCompletion5=true;_didIteratorError5=false;_iteratorError5=undefined;_context.prev=5;_iterator5=entries[Symbol.iterator]();case 7:if(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done){_context.next=15;break}entry=_step5.value;if(!(!this.predicate||this.predicate(entry.schemaValues()))){_context.next=12;break}_context.next=12;return entry;case 12:_iteratorNormalCompletion5=true;_context.next=7;break;case 15:_context.next=21;break;case 17:_context.prev=17;_context.t0=_context["catch"](5);_didIteratorError5=true;_iteratorError5=_context.t0;case 21:_context.prev=21;_context.prev=22;if(!_iteratorNormalCompletion5&&_iterator5["return"]){
_iterator5["return"]()}case 24:_context.prev=24;if(!_didIteratorError5){_context.next=27;break}throw _iteratorError5;case 27:return _context.finish(24);case 28:return _context.finish(21);case 29:case"end":return _context.stop()}}},entries,this,[[5,17,21,29],[22,,24,28]])})},{key:"values",value:function values(opts){var result=this.all().map(function(model){return model.values(opts)});if(!!QuerySet.recompute&&!!result)this.packRecompute(result,"values",opts);return result}},{key:"all",value:function all(){var result=[].concat(_toConsumableArray(this.entries()));if(!!QuerySet.recompute&&!!result)this.packRecompute(result,"all");return result}},{key:"first",value:function first(){var result=this.entries().next().value;if(!!QuerySet.recompute&&!!result)this.packRecompute(result,"first");return result}},{key:"at",value:function at(index){var entries=this.entries();var entry={value:undefined,done:true};var counter=0;for(counter=0;counter<=index;++counter){entry=entries.next();if(entry.done)break}if(entry.value===undefined||counter<index){throw new OutOfRange(index)}if(!!QuerySet.recompute&&!!entry.value)this.packRecompute(entry.value,"at",index);return entry.value}},{key:"last",value:function last(){var all=this.all();var result=all[all.length-1];if(!!QuerySet.recompute&&!!result)this.packRecompute(result,"last");return result}},{key:"update",value:function update(values,opts){var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=this.entries()[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var entry=_step6.value;entry.update(values,opts)}}catch(err){_didIteratorError6=true;_iteratorError6=err}finally{try{if(!_iteratorNormalCompletion6&&_iterator6["return"]){_iterator6["return"]()}}finally{if(_didIteratorError6){throw _iteratorError6}}}return this}},{key:"packRecompute",value:function packRecompute(result,func){for(var _len2=arguments.length,args=Array(_len2>2?_len2-2:0),_key2=2;_key2<_len2;_key2++){args[_key2-2]=arguments[_key2]}var _this7=this;result.__qpack__={queryset:this,recompute:function recompute(){return _this7[func].apply(_this7,args)}}}},{key:"count",value:function count(){if(process.env.NODE_ENV!=="production"){util.debuglog("queryset.count() is deprecated. Use queryset.all().length instead")}return this.all().length}},{key:"delete",value:function _delete(){var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=this.entries()[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var entry=_step7.value;entry["delete"]()}}catch(err){_didIteratorError7=true;_iteratorError7=err}finally{try{if(!_iteratorNormalCompletion7&&_iterator7["return"]){_iterator7["return"]()}}finally{if(_didIteratorError7){throw _iteratorError7}}}return this}},{key:"get",value:function get(expression){var iterator=!!expression?this.filter(expression).entries():this.entries();var entry=iterator.next();if(entry.value===undefined)throw new DoesNotExist(expression);if(!iterator.next().done)throw new MoreThanOneValue(expression);if(!!QuerySet.recompute&&!!entry.value)this.packRecompute(entry.value,"get",expression);return entry.value}}]);return QuerySet}(EventEmitter);module.exports=QuerySet}).call(this,require("_process"))},{"./emitter":11,_process:5,util:8}],17:[function(require,module,exports){"use strict";var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Field=function(){function Field(_ref){var _ref$initial=_ref.initial;var initial=_ref$initial===undefined?null:_ref$initial;var _ref$index=_ref.index;var index=_ref$index===undefined?false:_ref$index;var _ref$unique=_ref.unique;var unique=_ref$unique===undefined?false:_ref$unique;_classCallCheck(this,Field);this.initial=initial;this.index=index;this.unique=unique}_createClass(Field,null,[{key:"create",value:function create(spec){if(spec instanceof Field)return spec;var field=null;if((typeof spec==="undefined"?"undefined":_typeof(spec))==="object"&&spec!==null&&!Array.isArray(spec)){field=new Field(spec)}else{field=new Field({initial:spec})}return field}}]);return Field}();var IndexedField=function(_Field){_inherits(IndexedField,_Field);function IndexedField(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{initial:null,unique:false};_classCallCheck(this,IndexedField);return _possibleConstructorReturn(this,(IndexedField.__proto__||Object.getPrototypeOf(IndexedField)).call(this,Object.assign({index:true},opts)))}return IndexedField}(Field);var Schema=function(){function Schema(){var fields=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,Schema);this._fields={};var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=Object.keys(fields)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var name=_step.value;this._fields[name]=Field.create(fields[name])}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}this._fields.id=new Field({index:true,unique:true})}_createClass(Schema,[{key:"fields",value:regeneratorRuntime.mark(function fields(){var _iteratorNormalCompletion2,_didIteratorError2,_iteratorError2,_iterator2,_step2,name;return regeneratorRuntime.wrap(function fields$(_context){while(1){switch(_context.prev=_context.next){case 0:_iteratorNormalCompletion2=true;_didIteratorError2=false;_iteratorError2=undefined;_context.prev=3;_iterator2=Object.keys(this._fields)[Symbol.iterator]();case 5:if(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done){_context.next=12;break}name=_step2.value;_context.next=9;return[name,this._fields[name]];case 9:_iteratorNormalCompletion2=true;_context.next=5;break;case 12:_context.next=18;break;case 14:_context.prev=14;_context.t0=_context["catch"](3);_didIteratorError2=true;_iteratorError2=_context.t0;case 18:_context.prev=18;_context.prev=19;if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]()}case 21:_context.prev=21;if(!_didIteratorError2){_context.next=24;break}throw _iteratorError2;case 24:return _context.finish(21);case 25:return _context.finish(18);case 26:case"end":return _context.stop()}}},fields,this,[[3,14,18,26],[19,,21,25]])})},{key:"names",value:regeneratorRuntime.mark(function names(){var _iteratorNormalCompletion3,_didIteratorError3,_iteratorError3,_iterator3,_step3,name;return regeneratorRuntime.wrap(function names$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_iteratorNormalCompletion3=true;_didIteratorError3=false;_iteratorError3=undefined;_context2.prev=3;_iterator3=Object.keys(this._fields)[Symbol.iterator]();case 5:if(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done){_context2.next=12;break}name=_step3.value;_context2.next=9;return name;case 9:_iteratorNormalCompletion3=true;_context2.next=5;break;case 12:_context2.next=18;break;case 14:_context2.prev=14;_context2.t0=_context2["catch"](3);_didIteratorError3=true;_iteratorError3=_context2.t0;case 18:_context2.prev=18;_context2.prev=19;if(!_iteratorNormalCompletion3&&_iterator3["return"]){_iterator3["return"]()}case 21:_context2.prev=21;if(!_didIteratorError3){_context2.next=24;break}throw _iteratorError3;case 24:return _context2.finish(21);case 25:return _context2.finish(18);case 26:case"end":return _context2.stop()}}},names,this,[[3,14,18,26],[19,,21,25]])})},{key:"initials",value:regeneratorRuntime.mark(function initials(){var _iteratorNormalCompletion4,_didIteratorError4,_iteratorError4,_iterator4,_step4,_step4$value,name,field;return regeneratorRuntime.wrap(function initials$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_iteratorNormalCompletion4=true;_didIteratorError4=false;_iteratorError4=undefined;_context3.prev=3;_iterator4=this.fields()[Symbol.iterator]();case 5:if(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done){_context3.next=14;break}_step4$value=_slicedToArray(_step4.value,2);name=_step4$value[0];field=_step4$value[1];_context3.next=11;return[name,field.initial];case 11:_iteratorNormalCompletion4=true;_context3.next=5;break;case 14:_context3.next=20;break;case 16:_context3.prev=16;_context3.t0=_context3["catch"](3);_didIteratorError4=true;_iteratorError4=_context3.t0;case 20:_context3.prev=20;_context3.prev=21;if(!_iteratorNormalCompletion4&&_iterator4["return"]){_iterator4["return"]()}case 23:_context3.prev=23;if(!_didIteratorError4){_context3.next=26;break}throw _iteratorError4;case 26:return _context3.finish(23);case 27:return _context3.finish(20);case 28:case"end":return _context3.stop()}}},initials,this,[[3,16,20,28],[21,,23,27]])})},{key:"has",value:function has(name){return name in this._fields}},{key:"isIndexed",value:function isIndexed(name){return this._fields[name].index}},{key:"isUnique",value:function isUnique(name){return this._fields[name].unique}}]);return Schema}();Schema.IndexedField=IndexedField;module.exports=Schema},{}],18:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ObjectManager=require("./manager");var Schema=require("./schema");var Model=require("./model");var Tree=require("./tree");var Store=function(_Tree){_inherits(Store,_Tree);function Store(){_classCallCheck(this,Store);return _possibleConstructorReturn(this,(Store.__proto__||Object.getPrototypeOf(Store)).apply(this,arguments))}_createClass(Store,[{key:"_register",value:function _register(name,_ref){var _ref$model=_ref.model;var model=_ref$model===undefined?null:_ref$model;var _ref$schema=_ref.schema;var schema=_ref$schema===undefined?{}:_ref$schema;var _ref$manager=_ref.manager;var manager=_ref$manager===undefined?ObjectManager:_ref$manager;var ManagerType=manager;var ModelType=model||function(_Model){_inherits(_class,_Model);function _class(){_classCallCheck(this,_class);return _possibleConstructorReturn(this,(_class.__proto__||Object.getPrototypeOf(_class)).apply(this,arguments))}return _class}(Model);ModelType.schema=new Schema(schema);ModelType.objects=new ManagerType(ModelType);this[name]=ModelType.objects;this._leafs.add(name);return ModelType}}]);return Store}(Tree);module.exports=Store},{"./manager":13,"./model":14,"./schema":17,"./tree":19}],19:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Tree=function(){function Tree(){_classCallCheck(this,Tree);this._leafs=new Set;this._trees=new Set}_createClass(Tree,[{key:"dump",value:regeneratorRuntime.mark(function dump(){var _iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,leaf,_iteratorNormalCompletion2,_didIteratorError2,_iteratorError2,_iterator2,_step2,name,_iteratorNormalCompletion3,_didIteratorError3,_iteratorError3,_iterator3,_step3,branch;return regeneratorRuntime.wrap(function dump$(_context){while(1){switch(_context.prev=_context.next){case 0:_iteratorNormalCompletion=true;_didIteratorError=false;_iteratorError=undefined;_context.prev=3;_iterator=this._leafs[Symbol.iterator]();case 5:if(_iteratorNormalCompletion=(_step=_iterator.next()).done){_context.next=12;break}leaf=_step.value;_context.next=9;return leaf;case 9:_iteratorNormalCompletion=true;_context.next=5;break;case 12:_context.next=18;break;case 14:_context.prev=14;_context.t0=_context["catch"](3);_didIteratorError=true;_iteratorError=_context.t0;case 18:_context.prev=18;_context.prev=19;if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}case 21:_context.prev=21;if(!_didIteratorError){_context.next=24;break}throw _iteratorError;case 24:return _context.finish(21);case 25:return _context.finish(18);case 26:_iteratorNormalCompletion2=true;_didIteratorError2=false;_iteratorError2=undefined;_context.prev=29;_iterator2=this._trees[Symbol.iterator]();case 31:if(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done){_context.next=62;break}name=_step2.value;_iteratorNormalCompletion3=true;_didIteratorError3=false;_iteratorError3=undefined;_context.prev=36;_iterator3=this[name].dump()[Symbol.iterator]();case 38:if(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done){_context.next=45;break}branch=_step3.value;_context.next=42;return name+"."+branch;case 42:_iteratorNormalCompletion3=true;_context.next=38;break;case 45:_context.next=51;break;case 47:_context.prev=47;_context.t1=_context["catch"](36);_didIteratorError3=true;_iteratorError3=_context.t1;case 51:_context.prev=51;_context.prev=52;if(!_iteratorNormalCompletion3&&_iterator3["return"]){_iterator3["return"]()}case 54:_context.prev=54;if(!_didIteratorError3){_context.next=57;break}throw _iteratorError3;case 57:return _context.finish(54);case 58:return _context.finish(51);case 59:_iteratorNormalCompletion2=true;_context.next=31;break;case 62:_context.next=68;break;case 64:_context.prev=64;_context.t2=_context["catch"](29);_didIteratorError2=true;_iteratorError2=_context.t2;case 68:_context.prev=68;_context.prev=69;if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]()}case 71:_context.prev=71;if(!_didIteratorError2){_context.next=74;break}throw _iteratorError2;case 74:return _context.finish(71);case 75:return _context.finish(68);case 76:case"end":return _context.stop()}}},dump,this,[[3,14,18,26],[19,,21,25],[29,64,68,76],[36,47,51,59],[52,,54,58],[69,,71,75]])})},{key:"registerAll",value:function registerAll(subs){var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=Object.keys(subs)[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var name=_step4.value;this.register(name,subs[name])}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4["return"]){_iterator4["return"]()}}finally{if(_didIteratorError4){throw _iteratorError4}}}}},{key:"register",value:function register(names,sub){var name=null;if((typeof names==="undefined"?"undefined":_typeof(names))==="object")return this.registerAll(names);name=names;if(name in this)return;if(!!sub&&sub instanceof this.constructor){var tree=sub;this[name]=tree;this._trees.add(name);return tree}return this._register(name,sub||{})}},{key:"forget",value:function forget(name){if(this._trees.has(name)){this._trees["delete"](name);delete this[name]}else if(this._leafs.has(name)){this._leafs["delete"](name);delete this[name]}}},{key:"tree",get:function get(){return[].concat(_toConsumableArray(this.dump()))}}]);return Tree}();module.exports=Tree},{}],20:[function(require,module,exports){(function(Buffer){var clone=function(){"use strict";var nativeMap;try{nativeMap=Map}catch(_){nativeMap=function(){}}var nativeSet;try{nativeSet=Set}catch(_){nativeSet=function(){}}var nativePromise;try{nativePromise=Promise}catch(_){nativePromise=function(){}}function clone(parent,circular,depth,prototype){var filter;if(typeof circular==="object"){depth=circular.depth;prototype=circular.prototype;filter=circular.filter;circular=circular.circular}var allParents=[];var allChildren=[];var useBuffer=typeof Buffer!="undefined";if(typeof circular=="undefined")circular=true;if(typeof depth=="undefined")depth=Infinity;function _clone(parent,depth){if(parent===null)return null;if(depth===0)return parent;var child;var proto;if(typeof parent!="object"){return parent}if(parent instanceof nativeMap){child=new nativeMap}else if(parent instanceof nativeSet){child=new nativeSet}else if(parent instanceof nativePromise){child=new nativePromise(function(resolve,reject){parent.then(function(value){resolve(_clone(value,depth-1))},function(err){reject(_clone(err,depth-1))})})}else if(clone.__isArray(parent)){child=[]}else if(clone.__isRegExp(parent)){child=new RegExp(parent.source,__getRegExpFlags(parent));if(parent.lastIndex)child.lastIndex=parent.lastIndex}else if(clone.__isDate(parent)){child=new Date(parent.getTime())}else if(useBuffer&&Buffer.isBuffer(parent)){child=new Buffer(parent.length);parent.copy(child);return child}else{if(typeof prototype=="undefined"){proto=Object.getPrototypeOf(parent);child=Object.create(proto)}else{child=Object.create(prototype);proto=prototype}}if(circular){var index=allParents.indexOf(parent);if(index!=-1){return allChildren[index]}allParents.push(parent);allChildren.push(child)}if(parent instanceof nativeMap){var keyIterator=parent.keys();while(true){var next=keyIterator.next();if(next.done){break}var keyChild=_clone(next.value,depth-1);var valueChild=_clone(parent.get(next.value),depth-1);child.set(keyChild,valueChild)}}if(parent instanceof nativeSet){var iterator=parent.keys();while(true){var next=iterator.next();if(next.done){break}var entryChild=_clone(next.value,depth-1);child.add(entryChild)}}for(var i in parent){var attrs;if(proto){attrs=Object.getOwnPropertyDescriptor(proto,i)}if(attrs&&attrs.set==null){continue}child[i]=_clone(parent[i],depth-1)}if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(parent);for(var i=0;i<symbols.length;i++){var symbol=symbols[i];child[symbol]=_clone(parent[symbol],depth-1)}}return child}return _clone(parent,depth)}clone.clonePrototype=function clonePrototype(parent){if(parent===null)return null;var c=function(){};c.prototype=parent;return new c};function __objToStr(o){return Object.prototype.toString.call(o)}clone.__objToStr=__objToStr;function __isDate(o){return typeof o==="object"&&__objToStr(o)==="[object Date]"}clone.__isDate=__isDate;function __isArray(o){return typeof o==="object"&&__objToStr(o)==="[object Array]"}clone.__isArray=__isArray;function __isRegExp(o){return typeof o==="object"&&__objToStr(o)==="[object RegExp]"}clone.__isRegExp=__isRegExp;function __getRegExpFlags(re){var flags="";if(re.global)flags+="g";if(re.ignoreCase)flags+="i";if(re.multiline)flags+="m";return flags}clone.__getRegExpFlags=__getRegExpFlags;return clone}();if(typeof module==="object"&&module.exports){module.exports=clone}}).call(this,require("buffer").Buffer)},{buffer:2}],21:[function(require,module,exports){var fbemitter={EventEmitter:require("./lib/BaseEventEmitter")};module.exports=fbemitter},{"./lib/BaseEventEmitter":22}],22:[function(require,module,exports){(function(process){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var EmitterSubscription=require("./EmitterSubscription");var EventSubscriptionVendor=require("./EventSubscriptionVendor");var emptyFunction=require("fbjs/lib/emptyFunction");var invariant=require("fbjs/lib/invariant");var BaseEventEmitter=function(){function BaseEventEmitter(){_classCallCheck(this,BaseEventEmitter);this._subscriber=new EventSubscriptionVendor;this._currentSubscription=null}BaseEventEmitter.prototype.addListener=function addListener(eventType,listener,context){return this._subscriber.addSubscription(eventType,new EmitterSubscription(this._subscriber,listener,context))};BaseEventEmitter.prototype.once=function once(eventType,listener,context){var emitter=this;return this.addListener(eventType,function(){emitter.removeCurrentListener();listener.apply(context,arguments)})};BaseEventEmitter.prototype.removeAllListeners=function removeAllListeners(eventType){this._subscriber.removeAllSubscriptions(eventType)};BaseEventEmitter.prototype.removeCurrentListener=function removeCurrentListener(){!!!this._currentSubscription?process.env.NODE_ENV!=="production"?invariant(false,"Not in an emitting cycle; there is no current subscription"):invariant(false):undefined;this._subscriber.removeSubscription(this._currentSubscription)};BaseEventEmitter.prototype.listeners=function listeners(eventType){var subscriptions=this._subscriber.getSubscriptionsForType(eventType);return subscriptions?subscriptions.filter(emptyFunction.thatReturnsTrue).map(function(subscription){return subscription.listener}):[]};BaseEventEmitter.prototype.emit=function emit(eventType){var subscriptions=this._subscriber.getSubscriptionsForType(eventType);if(subscriptions){var keys=Object.keys(subscriptions);for(var ii=0;ii<keys.length;ii++){var key=keys[ii];var subscription=subscriptions[key];if(subscription){this._currentSubscription=subscription;this.__emitToSubscription.apply(this,[subscription].concat(Array.prototype.slice.call(arguments)))}}this._currentSubscription=null}};BaseEventEmitter.prototype.__emitToSubscription=function __emitToSubscription(subscription,eventType){var args=Array.prototype.slice.call(arguments,2);subscription.listener.apply(subscription.context,args)};return BaseEventEmitter}();module.exports=BaseEventEmitter}).call(this,require("_process"))},{"./EmitterSubscription":23,"./EventSubscriptionVendor":25,_process:5,"fbjs/lib/emptyFunction":26,"fbjs/lib/invariant":27}],23:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var EventSubscription=require("./EventSubscription");var EmitterSubscription=function(_EventSubscription){_inherits(EmitterSubscription,_EventSubscription);function EmitterSubscription(subscriber,listener,context){_classCallCheck(this,EmitterSubscription);_EventSubscription.call(this,subscriber);this.listener=listener;this.context=context}return EmitterSubscription}(EventSubscription);module.exports=EmitterSubscription},{"./EventSubscription":24}],24:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var EventSubscription=function(){function EventSubscription(subscriber){_classCallCheck(this,EventSubscription);this.subscriber=subscriber}EventSubscription.prototype.remove=function remove(){if(this.subscriber){this.subscriber.removeSubscription(this);this.subscriber=null}};return EventSubscription}();module.exports=EventSubscription},{}],25:[function(require,module,exports){(function(process){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var invariant=require("fbjs/lib/invariant");var EventSubscriptionVendor=function(){function EventSubscriptionVendor(){_classCallCheck(this,EventSubscriptionVendor);this._subscriptionsForType={};this._currentSubscription=null}EventSubscriptionVendor.prototype.addSubscription=function addSubscription(eventType,subscription){!(subscription.subscriber===this)?process.env.NODE_ENV!=="production"?invariant(false,"The subscriber of the subscription is incorrectly set."):invariant(false):undefined;if(!this._subscriptionsForType[eventType]){this._subscriptionsForType[eventType]=[]}var key=this._subscriptionsForType[eventType].length;this._subscriptionsForType[eventType].push(subscription);subscription.eventType=eventType;subscription.key=key;return subscription};EventSubscriptionVendor.prototype.removeAllSubscriptions=function removeAllSubscriptions(eventType){if(eventType===undefined){this._subscriptionsForType={}}else{delete this._subscriptionsForType[eventType]}};EventSubscriptionVendor.prototype.removeSubscription=function removeSubscription(subscription){var eventType=subscription.eventType;var key=subscription.key;var subscriptionsForType=this._subscriptionsForType[eventType];if(subscriptionsForType){delete subscriptionsForType[key]}};EventSubscriptionVendor.prototype.getSubscriptionsForType=function getSubscriptionsForType(eventType){return this._subscriptionsForType[eventType]};return EventSubscriptionVendor}();module.exports=EventSubscriptionVendor}).call(this,require("_process"))},{_process:5,"fbjs/lib/invariant":27}],26:[function(require,module,exports){"use strict";function makeEmptyFunction(arg){return function(){return arg}}function emptyFunction(){}emptyFunction.thatReturns=makeEmptyFunction;emptyFunction.thatReturnsFalse=makeEmptyFunction(false);emptyFunction.thatReturnsTrue=makeEmptyFunction(true);emptyFunction.thatReturnsNull=makeEmptyFunction(null);emptyFunction.thatReturnsThis=function(){return this};emptyFunction.thatReturnsArgument=function(arg){return arg};module.exports=emptyFunction},{}],27:[function(require,module,exports){(function(process){"use strict";function invariant(condition,format,a,b,c,d,e,f){if(process.env.NODE_ENV!=="production"){if(format===undefined){throw new Error("invariant requires an error message argument")}}if(!condition){var error;if(format===undefined){error=new Error("Minified exception occurred; use the non-minified dev environment "+"for the full error message and additional helpful warnings.")}else{var args=[a,b,c,d,e,f];var argIndex=0;error=new Error(format.replace(/%s/g,function(){return args[argIndex++]}));error.name="Invariant Violation"}error.framesToPop=1;throw error}}module.exports=invariant}).call(this,require("_process"))},{_process:5}],28:[function(require,module,exports){module.exports.Dispatcher=require("./lib/Dispatcher")},{"./lib/Dispatcher":29}],29:[function(require,module,exports){(function(process){"use strict";exports.__esModule=true;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var invariant=require("fbjs/lib/invariant");var _prefix="ID_";var Dispatcher=function(){function Dispatcher(){_classCallCheck(this,Dispatcher);this._callbacks={};this._isDispatching=false;this._isHandled={};this._isPending={};this._lastID=1}Dispatcher.prototype.register=function register(callback){var id=_prefix+this._lastID++;this._callbacks[id]=callback;return id};Dispatcher.prototype.unregister=function unregister(id){!this._callbacks[id]?process.env.NODE_ENV!=="production"?invariant(false,"Dispatcher.unregister(...): `%s` does not map to a registered callback.",id):invariant(false):undefined;delete this._callbacks[id]};Dispatcher.prototype.waitFor=function waitFor(ids){!this._isDispatching?process.env.NODE_ENV!=="production"?invariant(false,"Dispatcher.waitFor(...): Must be invoked while dispatching."):invariant(false):undefined;for(var ii=0;ii<ids.length;ii++){var id=ids[ii];if(this._isPending[id]){!this._isHandled[id]?process.env.NODE_ENV!=="production"?invariant(false,"Dispatcher.waitFor(...): Circular dependency detected while "+"waiting for `%s`.",id):invariant(false):undefined;continue}!this._callbacks[id]?process.env.NODE_ENV!=="production"?invariant(false,"Dispatcher.waitFor(...): `%s` does not map to a registered callback.",id):invariant(false):undefined;this._invokeCallback(id)}};Dispatcher.prototype.dispatch=function dispatch(payload){!!this._isDispatching?process.env.NODE_ENV!=="production"?invariant(false,"Dispatch.dispatch(...): Cannot dispatch in the middle of a dispatch."):invariant(false):undefined;this._startDispatching(payload);try{for(var id in this._callbacks){if(this._isPending[id]){continue}this._invokeCallback(id)}}finally{this._stopDispatching()}};Dispatcher.prototype.isDispatching=function isDispatching(){
return this._isDispatching};Dispatcher.prototype._invokeCallback=function _invokeCallback(id){this._isPending[id]=true;this._callbacks[id](this._pendingPayload);this._isHandled[id]=true};Dispatcher.prototype._startDispatching=function _startDispatching(payload){for(var id in this._callbacks){this._isPending[id]=false;this._isHandled[id]=false}this._pendingPayload=payload;this._isDispatching=true};Dispatcher.prototype._stopDispatching=function _stopDispatching(){delete this._pendingPayload;this._isDispatching=false};return Dispatcher}();module.exports=Dispatcher}).call(this,require("_process"))},{_process:5,"fbjs/lib/invariant":30}],30:[function(require,module,exports){(function(process){"use strict";var invariant=function(condition,format,a,b,c,d,e,f){if(process.env.NODE_ENV!=="production"){if(format===undefined){throw new Error("invariant requires an error message argument")}}if(!condition){var error;if(format===undefined){error=new Error("Minified exception occurred; use the non-minified dev environment "+"for the full error message and additional helpful warnings.")}else{var args=[a,b,c,d,e,f];var argIndex=0;error=new Error("Invariant Violation: "+format.replace(/%s/g,function(){return args[argIndex++]}))}error.framesToPop=1;throw error}};module.exports=invariant}).call(this,require("_process"))},{_process:5}],31:[function(require,module,exports){var hat=module.exports=function(bits,base){if(!base)base=16;if(bits===undefined)bits=128;if(bits<=0)return"0";var digits=Math.log(Math.pow(2,bits))/Math.log(base);for(var i=2;digits===Infinity;i*=2){digits=Math.log(Math.pow(2,bits/i))/Math.log(base)*i}var rem=digits-Math.floor(digits);var res="";for(var i=0;i<Math.floor(digits);i++){var x=Math.floor(Math.random()*base).toString(base);res=x+res}if(rem){var b=Math.pow(base,rem);var x=Math.floor(Math.random()*b).toString(base);res=x+res}var parsed=parseInt(res,base);if(parsed!==Infinity&&parsed>=Math.pow(2,bits)){return hat(bits,base)}else return res};hat.rack=function(bits,base,expandBy){var fn=function(data){var iters=0;do{if(iters++>10){if(expandBy)bits+=expandBy;else throw new Error("too many ID collisions, use more bits")}var id=hat(bits,base)}while(Object.hasOwnProperty.call(hats,id));hats[id]=data;return id};var hats=fn.hats={};fn.get=function(id){return fn.hats[id]};fn.set=function(id,value){fn.hats[id]=value;return fn};fn.bits=bits||128;fn.base=base||16;return fn}},{}]},{},[12])(12)});